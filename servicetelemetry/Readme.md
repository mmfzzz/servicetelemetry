# 远程服务监控系统

一个基于 Golang 开发的轻量级远程服务可用性监控平台，支持 HTTP/HTTPS/TCP 服务监控、历史数据查询、AI 监控总结以及通用智能问答功能，界面简洁美观，操作便捷。

## ✨ 核心特性

- ✅ **多协议监控**：支持 HTTP/HTTPS/TCP 服务健康检查
- ✅ **智能检测**：响应耗时、SSL 证书状态、关键词匹配一体化检测
- ✅ **AI 双模式**：监控数据智能总结 + 通用技术问答
- ✅ **实时大屏**：可视化监控数据展示，状态一目了然
- ✅ **历史追溯**：监控数据持久化存储，支持时间范围查询
- ✅ **配置热加载**：运行时动态更新配置，无需重启服务
- ✅ **优先级调度**：带优先级的并发任务管理

## 🚀 项目简介

该系统核心实现了远程服务的可用性检测（状态、响应耗时、SSL 证书、关键词匹配），并提供数据持久化、历史查询、AI 总结等附加功能，同时集成大模型实现通用智能问答，满足运维监控与技术咨询的双重需求。

### 核心功能

1.  **服务监控配置**：支持批量添加 HTTP/HTTPS/TCP 服务目标，自定义响应体关键词匹配。
2.  **实时监控检测**：一键触发监控检测，返回实时服务状态、响应耗时、SSL 证书状态等原始数据。
3.  **历史监控数据查询**：支持按服务地址、时间范围查询历史监控数据，支持页面数据清空（不删除数据库数据）。
4.  **纯数据展示**：精准返回结构化监控原始数据表格，无 AI 加工，适合故障排查。
5.  **AI 监控总结**：对监控数据进行精简运维视角总结，快速掌握服务整体状态。
6.  **通用智能问答**：脱离监控数据限制，回答任意技术、常识类问题，支持运维知识咨询。

## 🔧 环境准备

### 前置依赖

1.  **Golang 1.19 及以上版本**
2.  **关系型数据库**（推荐 MySQL 8.0+，需提前创建数据库）
3.  **大模型 API 密钥**（支持 DeepSeek、OpenAI、通义千问，需有可用额度/免费额度）
4.  **浏览器**（Chrome、Edge等现代浏览器）

### 依赖安装

```bash
# 克隆项目后，进入项目根目录执行
go mod tidy
```

## ⚡ 快速开始

### 1. 配置修改

修改项目 `config/default.go` 文件，配置数据库信息与大模型参数：

```go
package config

import "time"

// 数据库配置（根据自身环境修改）
func DefaultDBConfig() *DBConfig {
    return &DBConfig{
        DSN: "root:你的数据库密码@tcp(127.0.0.1:3306)/service_monitor?charset=utf8mb4&parseTime=True&loc=Local",
        MaxOpenConns: 10,
        MaxIdleConns: 5,
    }
}

// AI 大模型配置（根据自身使用的大模型修改）
func DefaultAgentConfig() *AgentConfig {
    return &AgentConfig{
        EnableAI: true, // 开启 AI 功能（关闭则仅保留监控相关功能）
        DefaultTimeRange: 24 * time.Hour,
        LLM: LLMConfig{
            APIKey:      "你的大模型 API Key", // 替换为自身 API Key
            APIBaseURL:  "https://dashscope.aliyuncs.com/compatible-mode/v1", // 通义千问兼容地址（可替换为 DeepSeek/OpenAI 地址）
            ModelName:   "qwen-turbo", // 模型名称（通义千问 qwen-turbo / DeepSeek deepseek-chat / OpenAI gpt-3.5-turbo）
            Temperature: 0.7,
            Timeout:     15 * time.Second,
        },
    }
}
```

### 2. 数据库初始化

系统会自动初始化数据库表结构，只需确保 MySQL 服务正常运行，并创建对应的数据库：

```sql
-- 创建数据库（如果不存在）
CREATE DATABASE IF NOT EXISTS service_monitor 
DEFAULT CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

### 3. 启动项目

```bash
# 项目根目录执行
go run main.go
```

### 4. 访问系统

启动成功后，打开浏览器访问：
```
http://localhost:8080/static
```
即可进入远程服务可用性监控系统界面。

## 📖 功能使用指南

### 一、服务监控配置与实时监控

1.  在「服务监控配置」的文本框中，输入监控目标，**每行一个**，支持格式：
    - HTTP/HTTPS：`https://www.github.com`、`http://www.baidu.com`
    - TCP：`tcp://127.0.0.1:8080`、`tcp://192.168.1.1:22`
2.  （可选）在关键词输入框中，输入需要匹配的响应体关键词（用于检测服务返回内容是否符合预期）。
3.  点击「开始监控」按钮，等待几秒后，下方会展示实时监控结果表格，包含「目标地址、状态、状态码、响应耗时、SSL 证书、关键词匹配、错误信息」等字段。
4.  监控结果会自动存入数据库，用于后续历史查询与 AI 总结。

### 二、历史监控数据查询与清空

1.  滚动到「历史监控数据」区域，可填写查询条件（可选）：
    - 目标地址：精准查询某一个服务的历史数据。
    - 开始时间/结束时间：查询指定时间段内的监控数据，不填写则默认查询近 24 小时。
2.  点击「查询历史数据」按钮，下方会展示匹配的历史监控数据表格。
3.  查看完毕后，点击「清空历史数据展示」按钮，可快速将页面展示恢复为「暂无历史数据」，并清空查询条件（**仅清空页面展示，不删除数据库数据**）。
4.  如需重新查询，直接输入新条件点击「查询历史数据」即可。

### 三、小助手功能（3个子功能）

小助手区域提供3个核心功能，满足不同场景需求，操作前需在输入框中填写对应内容。

#### 1. 纯数据展示
- **用途**：精准获取原始监控数据表格，无任何 AI 加工，适合故障排查、指标核对。
- **使用**：输入**监控相关问题**（例：「近 24 小时哪些服务异常？」「查看 github 的监控数据」），点击「纯数据展示」按钮。
- **结果**：返回结构化表格，包含「目标地址、状态、响应耗时、SSL 证书、错误信息」核心字段。

#### 2. 监控总结（AI）
- **用途**：快速获取监控数据的精简总结，无需手动查看表格提炼信息，适合日常巡检。
- **使用**：输入**监控相关问题**（例：「总结今天的监控情况」「SSL 证书异常的服务有哪些？」），点击「监控总结（AI）」按钮。
- **结果**：返回自然语言文本总结，突出异常服务、SSL 证书问题等核心信息。

#### 3. 通用问答（AI）
- **用途**：回答任意与监控无关的问题，支持运维技术、编程语言、通用常识等，无需记忆复杂指令。
- **使用**：输入**任意问题**（例：「如何排查 TCP 连接失败？」「HTTP 502 错误是什么意思？」「Go 协程和线程的区别？」），点击「通用问答（AI）」按钮。
- **结果**：返回自然语言回答，逻辑清晰，内容详实，可直接作为参考。

## 🎨 界面说明

| 区域名称         | 核心功能                     | 关键按钮                     |
|------------------|------------------------------|------------------------------|
| 服务监控配置     | 批量添加监控目标、触发实时监控 | 开始监控                     |
| 历史监控数据     | 查询历史数据、清空页面展示     | 查询历史数据、清空历史数据展示 |
| 小助手           | 纯数据展示、AI 总结、通用问答 | 纯数据展示、监控总结（AI）、通用问答（AI） |

## 🔌 API 接口

系统提供 RESTful API 接口，支持第三方集成：

| 方法 | 端点 | 说明 | 请求体示例 |
|------|------|------|-----------|
| POST | `/api/targets` | 提交监控目标 | `{"targets": ["https://github.com"], "keyword": "GitHub"}` |
| POST | `/api/agent/query` | AI 小助手查询 | `{"userQuery": "近24小时异常服务", "mode": "ai"}` |
| GET  | `/api/history/results` | 查询历史数据 | `?targetUrl=https://github.com&startTime=2024-01-01&endTime=2024-01-02` |

## 🗂️ 项目结构

```
servicetelemetry/
├── main.go                 # 应用入口
├── go.mod                 # Go 模块定义
├── config/
│   ├── config.go          # 配置结构定义
│   └── default.go         # 默认配置
├── core/
│   ├── checker.go         # 服务检查器
│   ├── concurrent.go      # 并发控制
│   └── model.go           # 数据模型
├── agent/
│   ├── model.go           # Agent 模型
│   ├── parser.go          # 查询解析器
│   ├── retriever.go       # 数据检索器
│   └── summarizer.go      # AI 总结器
├── api/
│   └── handler.go         # HTTP 处理器
├── storage/
│   └── mysql.go           # 数据库存储
├── static/
│   └── index.html         # 前端页面
└──
```

## ⚙️ 配置说明

### 数据库配置

| 参数 | 说明 | 默认值 |
|------|------|--------|
| DSN | 数据库连接字符串 | `root:123456@tcp(127.0.0.1:3306)/service_monitor?charset=utf8mb4&parseTime=True&loc=Local` |
| MaxOpenConns | 最大打开连接数 | 10 |
| MaxIdleConns | 最大空闲连接数 | 5 |

### AI 模型配置

| 参数 | 说明 | 示例值 |
|------|------|--------|
| EnableAI | 是否启用 AI 功能 | true |
| APIKey | 大模型 API 密钥 | `sk-xxx...` |
| APIBaseURL | API 基础地址 | `https://api.deepseek.com/v1` |
| ModelName | 模型名称 | `deepseek-chat` |
| Temperature | 生成温度 | 0.7 |
| Timeout | 请求超时时间 | 15s |

## ⚠️ 注意事项

1.  **大模型 API 相关**：
    - 确保 API Key 有效且有可用额度，余额不足会返回「402 Insufficient Balance」错误。
    - 不同大模型的 `APIBaseURL` 与 `ModelName` 需对应正确，否则无法正常调用。

2.  **数据库相关**：
    - 确保数据库服务已启动，且 DSN 配置正确，否则无法存储监控数据。
    - 监控数据会持久化存储，如需清理数据库中的历史数据，可直接操作数据库表。

3.  **功能限制**：
    - 「纯数据展示」与「监控总结（AI）」仅支持监控相关问题，通用问题会返回「未查询到相关数据」。
    - 系统仅支持 HTTP/HTTPS/TCP 协议的服务监控，暂不支持其他协议。

4.  **安全提示**：
    - 请勿将项目部署在公网未授权环境，避免敏感监控数据泄露。
    - API Key 请勿提交到公共代码仓库，建议通过环境变量注入。

## ❓ 常见问题

### Q1：点击「通用问答（AI）」返回监控总结，而非通用回答？
A：前端已自动添加 `/chat` 前缀，若仍返回监控总结，可检查：
1. 后端 `api/handler.go` 中的通用问答逻辑是否正常。
2. 输入的问题是否包含「如何」「什么是」等通用关键词，后端会通过关键词辅助识别。

### Q2：监控结果中显示「SSL 证书问题」，但服务实际正常？
A：可能是本地环境无法验证服务 SSL 证书，或证书已过期/即将过期，可手动访问服务地址验证证书状态。

### Q3：无法查询历史数据，提示「查询失败」？
A：检查：
1. 数据库服务是否正常运行。
2. 查询的时间范围是否有监控数据存入。
3. 数据库表是否已成功创建。

### Q4：AI 功能无法使用，提示「未开启」？
A：请检查 `config/default.go` 中的 `EnableAI` 是否为 `true`，并确保 API Key 配置正确。

## 🔮 后续规划

1.  **协议扩展**：支持更多协议（FTP、UDP、ICMP 等）的服务监控。
2.  **数据清理**：增加监控数据自动清理功能，支持设置数据保留时长。
3.  **告警功能**：增加邮件/短信/Webhook告警功能，当服务异常时自动推送告警。
4.  **移动适配**：优化前端界面，支持响应式布局，适配移动端访问。
5.  **用户管理**：支持多用户权限管理，细化数据访问权限。
6.  **监控面板**：增加数据可视化图表，展示服务健康趋势。
7.  **API 文档**：生成 OpenAPI/Swagger文档，便于第三方集成。

## 🤝 贡献指南

我欢迎任何形式的贡献！以下是参与项目的步骤：

1.  **Fork 仓库**
2.  **创建功能分支**
    ```bash
    git checkout -b feature/AmazingFeature
    ```
3.  **提交更改**
    ```bash
    git commit -m 'Add some AmazingFeature'
    ```
4.  **推送到分支**
    ```bash
    git push origin feature/AmazingFeature
    ```
5.  **开启 Pull Request**




## 📞 联系与支持

- **Email**: 2015946289@qq.com

**如果觉得这个项目有用，请给个 ⭐ Star 支持一下！**